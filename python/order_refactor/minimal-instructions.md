Refactor this codebase to a cleaner, more maintainable architecture.

- Introduce appropriate classes and abstractions.
- Remove duplication across modules.
- Eliminate obsolete or redundant code.
- Update the main program to use the new design without changing its output.
- Update or add tests so that all behavior is still verified.
- Ensure all tests pass after the refactor.
- Preserve all existing behavior, calculations, and printed values.
- Do whatever structural changes are necessary, but nothing should break.
